<html lang="ko-KR">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta property="og:title" content="starry-asterisk.github.io">
  <meta property="og:locale" content="ko_KR">
  <meta name="description" content="personal github blog">
  <meta property="og:description" content="personal github blog">
  <meta property="og:url" content="https://starry-asterisk.github.io/">
  <meta property="og:site_name" content="starry-asterisk.github.io">
  <meta property="og:type" content="website">
  <meta name="twitter:card" content="summary">
  <meta property="twitter:title" content="starry-asterisk.github.io">
  <link rel="canonical" href="https://starry-asterisk.github.io/">
  <link rel="icon" href="/favicon.png">
  <link rel="stylesheet" href="index.css">
  <script
    type="application/ld+json">{"@context":"https://schema.org","@type":"WebSite","description":"personal github blog","headline":"starry-asterisk.github.io","name":"starry-asterisk.github.io","url":"https://starry-asterisk.github.io/"}</script>

  <title>starry-asterisk.github.io | personal github blog</title>
</head>

<body>
  <header>
    <a class="logo" title="home" href="/">
      <img src="/logo.png" alt="✨">
      <span>starry-asterisk</span>
    </a>
    <nav>
      <a href="/about">about</a>
      <a href="/resume">resume</a>
    </nav>
  </header>
  <div class="middle">
    <aside>

    </aside>
    <main>
      <section class="posts" data-type="card">
        <ul></ul>
      </section>
      <button class="posts__next" style="display: none;"></button>
      <section class="git" data-type="list"></section>
    </main>
  </div>
  <footer>
    <p class="copyright">© 2023 starry-asterisk</p>
    <p>powered by <a href="#"></a>Git-hub</a>, written by <a href="#">starry-asterisk</a></p>
  </footer>
  <div class="full"></div>
</body>
<script>
  const USERNAME = 'starry-asterisk';
  const PER_PAGE = 5;
  let _git_color = {};
  let _emoji = {};
  let _user = {};
  let _repos = [];
  let _full = document.querySelector('.full');

  const queryString = window.location.search;
  const urlParams = new URLSearchParams(queryString);

  if (!urlParams.get('flag')) init();

  async function init() {
    _emoji = await getEmojis();
    _git_color = await getGitColors();
    _user = await getUsers();
    _repos = await getRepos();
    getIssues();
  }
  async function getEmojis() {
    let res = await fetch('/emojis.json');
    return await res.json();
  }
  async function getGitColors() {
    let res = await fetch('/git-colors.json');
    return await res.json();
  }
  async function getUsers() {
    let res = await fetch(`https://api.github.com/users/${USERNAME}`);
    let link = parse_link_header(res.headers);
    json = await res.json();

    gitAttr('avatar_url', json.avatar_url);
    gitAttr('html_url', json.html_url);
    gitAttr('name', json.name);
    gitAttr('login', json.login);

    return json;
  }
  async function getRepos(user = _user) {
    if ('repos_url' in user) {
      let res = await fetch(`${user.repos_url}?per_page=${PER_PAGE}`);
      let links = parse_link_header(res.headers);
      return await res.json();
    } else {
      return [];
    }
  }
  function getIssues(repos = _repos) {
    repos.forEach(async repo_data => {
      let git__wrap = createElement('div', { class: 'git__wrap fold' });

      let repo = createElement('div', { class: 'repo' });
      repo.appendChild(createElement('span', { class: 'repo__lang', 'data-lang': repo_data.language, style: `--lang-color: ${_git_color[repo_data.language].color};` }));
      repo.appendChild(createElement('a', { class: 'repo__title', href: repo_data.html_url }, repo_data.name));
      repo.appendChild(createElement('span', { class: 'repo__star' }, repo_data.stargazers_count));
      let repo__fold_button = createElement('button', { class: 'repo__fold_button' });
      repo.appendChild(repo__fold_button);
      repo.appendChild(createElement('p', { class: 'repo__desc' }, repo_data.description));
      git__wrap.appendChild(repo);

      let issue = createElement('ul', { class: 'issue' });
      git__wrap.appendChild(issue);
      git__wrap.appendChild(createElement('span', { class: 'issue_counter' }, repo_data.open_issues_count));

      document.querySelector('.git').appendChild(git__wrap);

      let next_link = `https://api.github.com/repos/${USERNAME}/${repo_data.name}/issues?state=all&per_page=${PER_PAGE}`;
      let issue__item__next = createElement('button', { class: 'issue__item__next' });

      if (repo_data.name == `${USERNAME}.github.io`) {
        repo__fold_button.onclick = () => git__wrap.classList.toggle('fold');
        document.querySelector('.posts__next').onclick = () => issue__item__next.onclick();
        renderIssues();
      } else {
        repo__fold_button.onclick = () => {
          git__wrap.classList.toggle('fold');
          repo__fold_button.onclick = () => git__wrap.classList.toggle('fold');
          renderIssues();
        };
      }

      async function renderIssues() {
        let res = await fetch(next_link);
        let links = parse_link_header(res.headers);
        if (links.last == next_link || links.last == null) {
          issue__item__next.classList.add('end');
          if (repo_data.name == `${USERNAME}.github.io`) document.querySelector('.posts__next').classList.add('end');
        }
        next_link = links.next;


        (await res.json()).forEach(issue_data => {
          if (repo_data.name == `${USERNAME}.github.io`) getPosts(issue_data);
          let issue__item = createElement('li', { class: 'issue__item', 'data-state': issue_data.state });
          issue__item.appendChild(createElement('a', { class: 'issue__item__title', href: issue_data.html_url }, issue_data.title));
          issue__item.appendChild(createElement('span', { class: 'issue__item__datetime' }, timeSince(new Date(issue_data.created_at))));
          issue__item.appendChild(createElement('span', { class: 'issue__item__desc' }, renderMarkDownText(issue_data.body)));
          let issue__item__label = createElement('ul', { class: 'issue__item__label' });
          issue_data.labels.forEach(
            label_data =>
              issue__item__label.appendChild(
                createElement('li', { style: `--label-color: #${label_data.color};`, title: label_data.description }, label_data.name)
              )
          );
          issue__item.appendChild(issue__item__label);
          let issue__item__full_button = createElement('button', { class: 'issue__item__full_button' });
          let _before_el;
          let _full_container = document.querySelector('.full');

          issue__item__full_button.onclick = function (e) {
            if (e.target != this) return false;
            if (document.body.classList.contains('full-mode')) {
              if (_before_el) {
                _before_el.after(issue__item);
              } else {
                issue.prepend(issue__item);
              }
            } else {
              _full.appendChild(issue__item);
            }
            document.body.classList.toggle('full-mode');
          };
          issue__item.appendChild(issue__item__full_button);
          issue.appendChild(issue__item);
          _before_el = issue__item.previousSibling;
        });
      }

      issue__item__next.onclick = renderIssues;
      git__wrap.appendChild(issue__item__next);
    });
  }
  function getPosts(issue_data) {
    document.querySelector('.posts__next').style.display = 'inline-block';
    let ul = document.querySelector('.posts>ul:last-child');
    if (ul.querySelector('.post:nth-child(15)')) {
      ul = createElement('ul');
      document.querySelector('.posts').appendChild(ul);
    }
    let li = createElement('li', { class: 'post' });
    let post__label = createElement('p', { class: 'post__label' });
    issue_data.labels.forEach(
      label_data =>
        post__label.appendChild(
          createElement('span', { style: `--label-color: #${label_data.color};`, title: label_data.description }, label_data.name)
        )
    );
    li.onclick = () => {
      let body_rect = document.body.getBoundingClientRect();
      let li_rect = li.getBoundingClientRect();
      let post_detail = createElement('div', {
        style: 'position: fixed;box-sizing: border-box;border: 1px solid var(--border-darker);z-index:99;box-shadow: 0 0 0 50vw #00000055;background: white;padding: 2.5rem;'
      });
      document.body.appendChild(post_detail);
      const keyframes = [
        {
          top: li_rect.top + 'px',
          left: li_rect.left + 'px',
          bottom: body_rect.height - li_rect.bottom + 'px',
          right: body_rect.width - li_rect.right + 'px',
        },
        {
          top: Rem2Px(5.5) + 'px',
          left: Rem2Px(1.5) + 'px',
          bottom: 0,
          right: Rem2Px(1.5) + 'px',
        }
      ];

      const option = {
        duration: 300,
        iterations: 1,
        fill: 'forwards',
      };

      post_detail.animate(keyframes, option).onfinish = () => {
        post_detail.appendChild(post__label.cloneNode(true));
        post_detail.appendChild(createElement('p', { class: 'post__title' }, issue_data.title));
        post_detail.appendChild(createElement('p', { class: 'post__datetime' }, timeSince(new Date(issue_data.created_at))));
        post_detail.appendChild(createElement('p', { class: 'post__desc' }, renderMarkDownText(issue_data.body)));
        let back_button = createElement('button', { style: 'position: absolute;bottom: 100%;margin-left: -1.5rem;padding: 0.5rem;color: white;' }, 'back');
        post_detail.appendChild(back_button);
        window.onmousemove = e => back_button.style.left = e.pageX + 'px'; 
        back_button.onclick = () => {
          window.onmousemove = null;
          post_detail.remove();
        }
      };
      //window.open('_blank').location.href=issue_data.html_url;
    }
    li.appendChild(post__label);
    li.appendChild(createElement('p', { class: 'post__title' }, issue_data.title));
    li.appendChild(createElement('p', { class: 'post__datetime' }, timeSince(new Date(issue_data.created_at))));
    li.appendChild(createElement('p', { class: 'post__desc' }, issue_data.body));
    ul.appendChild(li);
  }
  function alert(e) {
    console.log(e);
  }
  function gitAttr(attr, value) {
    document.querySelectorAll(`[git-target^="${attr},"]`).forEach(el => {
      let [attr, target] = el.getAttribute('git-target').split(',');
      if (target) {
        el.setAttribute(target, value);
      } else {
        el.innerHTML = value;
      }
      el.removeAttribute('git-target');
    });
  }
  function timeSince(date) {

    var seconds = Math.floor((new Date() - date) / 1000);

    var interval = seconds / 31536000;

    if (interval > 1) {
      return Math.floor(interval) + " years";
    }
    interval = seconds / 2592000;
    if (interval > 1) {
      return Math.floor(interval) + " months";
    }
    interval = seconds / 86400;
    if (interval > 1) {
      return Math.floor(interval) + " days";
    }
    interval = seconds / 3600;
    if (interval > 1) {
      return Math.floor(interval) + " hours";
    }
    interval = seconds / 60;
    if (interval > 1) {
      return Math.floor(interval) + " minutes";
    }
    return Math.floor(seconds) + " seconds";
  }

  function Rem2Px(rem) {
    return rem * parseFloat(getComputedStyle(document.documentElement).fontSize);
  }

  /**
   * 무작위 색상 코드를 만들어 주는 기능
   * @returns {string}
   */
  function randomColor() { return Math.floor(Math.random() * 16777215).toString(16) }

  /**
   * 문자열 속 URL 을 a 태그로 치환해주는 기능
   * @param text
   * @returns {*}
   */
  function renderLinkInText(text) {
    let urlRegex = /(https?:\/\/\S+)/g;
    /*
    return text.replace(urlRegex, function(url) {
        return '<a href="' + url + '">' + url + '</a>';
    })*/
    // or alternatively
    return text.replace(urlRegex, '<a href="$1" target="_blank" class="link">$1</a>')
  }

  /**
   * 문자열 속 URL 을 a 태그로 치환해주는 기능
   * @param text
   * @returns {*}
   * @referer : https://jung-max.github.io/2019/09/27/Web-Javascript-MarkDown%EA%B5%AC%ED%98%84/
   */
  function renderMarkDownText(text) {
    if (text == null) return '';
    //ul
    text = text.replace(/^\s*\n\*/gm, '<ul>\n*');
    text = text.replace(/^(\*.+)\s*\n([^\*])/gm, '$1\n</ul>\n\n$2');
    text = text.replace(/^\*(.+)/gm, '<li>$1</li>');

    //ol
    text = text.replace(/^\s*\n\d\./gm, '<ol>\n1.');
    text = text.replace(/^(\d\..+)\s*\n([^\d\.])/gm, '$1\n</ol>\n\n$2');
    text = text.replace(/^\d\.(.+)/gm, '<li>$1</li>');

    //blockquote
    text = text.replace(/^&gt;(.+)/gm, '<blockquote>$1</blockquote>');

    //h
    text = text.replace(/[\#]{6}(.+)/g, '<h6>$1</h6>');
    text = text.replace(/[\#]{5}(.+)/g, '<h5>$1</h5>');
    text = text.replace(/[\#]{4}(.+)/g, '<h4>$1</h4>');
    text = text.replace(/[\#]{3}(.+)/g, '<h3>$1</h3>');
    text = text.replace(/[\#]{2}(.+)/g, '<h2>$1</h2>');
    text = text.replace(/[\#]{1}(.+)/g, '<h1>$1</h1>');

    //alt h
    text = text.replace(/^(.+)\n\=+/gm, '<h1>$1</h1>');
    text = text.replace(/^(.+)\n\-+/gm, '<h2>$1</h2>');

    //images
    text = text.replace(/\!\[([^\]]+)\]\(([^\)]+)\)/g, '<img src="$2" alt="$1" />');

    //links
    text = text.replace(/[\[]{1}([^\]]+)[\]]{1}[\(]{1}([^\)\"]+)(\"(.+)\")?[\)]{1}/g, '<a href="$2" title="$4">$1</a>');

    //font styles
    text = text.replace(/[\*\_]{2}([^\*\_]+)[\*\_]{2}/g, '<b>$1</b>');
    text = text.replace(/[\*\_]{1}([^\*\_]+)[\*\_]{1}/g, '<i>$1</i>');
    text = text.replace(/[\~]{2}([^\~]+)[\~]{2}/g, '<del>$1</del>');

    //pre
    text = text.replace(/^\s*\n\`\`\`(([^\s]+))?/gm, '<pre class="$2">');
    text = text.replace(/^\`\`\`\s*\n/gm, '</pre>\n\n');

    //code
    text = text.replace(/[\`]{1}([^\`]+)[\`]{1}/g, '<code>$1</code>');

    text = text.replace(/(:(?![\n])[()#$@-\w]+:)/g, match => _emoji[match]);

    //p
    /*
    text = text.replace(/^\s*(\n)?(.+)/gm, function(m){
        return  /\<(\/)?(h\d|ul|ol|li|blockquote|pre|img)/.test(m) ? m : '<p>'+m+'</p>';
    });*/

    //strip p from pre
    //text = text.replace(/(\<pre.+\>)\s*\n\<p\>(.+)\<\/p\>/gm, '$1$2');

    return text;
  }
  let renderEmoji = String.prototype.renderEmoji = function () {
    return this.replace(/(:(?![\n])[()#$@-\w]+:)/g, match => match.replaceAll('_', '') in _emoji ? _emoji[match.replaceAll('_', '')] : match);
  }
  let renderImages = String.prototype.renderImages = function () {
    return this.replace(/\!\[([^\]]+)\]\(([^\)]+)\)/g, '<img src="$2" alt="$1" />');
  }
  let renderLinks = String.prototype.renderLinks = function () {
    return this.replace(/[\[]{1}([^\]]+)[\]]{1}[\(]{1}([^\)\"]+)(\"(.+)\")?[\)]{1}/g, '<a href="$2" title="$4">$1</a>');
  }
  let render_text = String.prototype.render = function () {
    return this.renderEmoji().renderImages().renderLinks();
  }


  function createElement(tag, options = {}, innerHTML = '') {
    let el = document.createElement(tag);
    for (attr in options) el.setAttribute(attr, options[attr]);
    if (innerHTML) el.innerHTML = innerHTML;
    return el;
  }

  function parse_link_header(header) {
    header = header.get('link');

    if (header == null) {
      return -1;
    }

    // Split parts by comma
    var parts = header.split(',');
    var links = {};
    // Parse each part into a named link
    for (let p of parts) {
      var section = p.split(';');
      if (section.length != 2) {
        throw new Error("section could not be split on ';'");
      }
      var url = section[0].replace(/<(.*)>/, '$1').trim();
      var name = section[1].replace(/rel="(.*)"/, '$1').trim();
      links[name] = url;
    }
    return links;
  }

</script>

</html>