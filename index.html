<html lang="ko-KR">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta property="og:title" content="starry-asterisk.github.io">
  <meta property="og:locale" content="ko_KR">
  <meta name="description" content="personal github blog">
  <meta property="og:description" content="personal github blog">
  <meta property="og:url" content="https://starry-asterisk.github.io/">
  <meta property="og:site_name" content="starry-asterisk.github.io">
  <meta property="og:type" content="website">
  <meta name="twitter:card" content="summary">
  <meta property="twitter:title" content="starry-asterisk.github.io">
  <link rel="canonical" href="https://starry-asterisk.github.io/">
  <link rel="icon" href="/favicon.png">
  <link rel="stylesheet" href="index.css">
  <script
    type="application/ld+json">{"@context":"https://schema.org","@type":"WebSite","description":"personal github blog","headline":"starry-asterisk.github.io","name":"starry-asterisk.github.io","url":"https://starry-asterisk.github.io/"}</script>

  <title>starry-asterisk.github.io | personal github blog</title>
</head>

<body>
  <header>
    <a class="logo" title="home" href="/">
      <img src="/logo.png" alt="✨">
      <span>starry-asterisk</span>
    </a>
    <nav>
      <a href="/about">about</a>
      <a href="/resume">resume</a>
    </nav>
  </header>
  <div class="middle">
    <aside>

    </aside>
    <main>
      <section class="profile">
        <div class="profile__left">
          <a class="profile__left__avatar" git-target="html_url,href" href="/#">
            <img git-target="avatar_url,src" alt="✨" src="/">
          </a>
          <h2 git-target="name">김현우</h5>
            <h5 git-target="login">starry-asterisk
          </h2>
          <h4>6507055@naver.com</h3>
        </div>
        <div class="profile__right">
          <div class="profile__right__description">
            개발자로서의 설명
          </div>
          <ul class="profile__right__skills">
            <li>HTML</li>
            <li>CSS</li>
            <li>javascript</li>
          </ul>
        </div>
      </section>
      <section class="posts" data-type="card" style="display: none;">
        <ul>
          <li>
            <img src="img_url" alt="title">
            <p>title | (tag) | 설명...</p>
            <p>1 min ago. 안녕하세요</p>
            <!--
              ------------------------------------------------


                              IMG Background


              ------------------------------------------------
              title  |  tag  | description...
              ------------------------------------------------
              latest comment
              ------------------------------------------------
            -->
          </li>
        </ul>
        <button class="button_more">view more</button>
      </section>
      <section class="git" data-type="list"></section>
    </main>
  </div>
  <footer>
    <p class="copyright">© 2023 starry-asterisk</p>
    <p>powered by <a href="#"></a>Git-hub</a>, written by <a href="#">starry-asterisk</a></p>
  </footer>
</body>
<script>
  /*
  git api

  https://api.github.com/repos/<username>/<repo>/issues < issue list
  https://api.github.com/users/<username>/repos < repo list
  https://api.github.com/users/<username> < user profile
  
  */
  const USERNAME = 'starry-asterisk';
  let _git_color = {};
  let _emoji = {};
  let _user = {};
  let _repos = [];

  const queryString = window.location.search;
  const urlParams = new URLSearchParams(queryString);

  if (!urlParams.get('flag')) init();

  async function init() {
    _emoji = await getEmojis();
    _git_color = await getGitColors();
    _user = await getUsers();
    _repos = await getRepos();
    getIssues();
  }
  async function getEmojis() {
    let res = await fetch('/emojis.json');
    return await res.json();
  }
  async function getGitColors() {
    let res = await fetch('/git-colors.json');
    return await res.json();
  }
  async function getUsers() {
    let res = await fetch(`https://api.github.com/users/${USERNAME}`);
    json = await res.json();

    gitAttr('avatar_url', json.avatar_url);
    gitAttr('html_url', json.html_url);
    gitAttr('name', json.name);
    gitAttr('login', json.login);

    return json;
  }
  async function getRepos(user = _user) {
    if ('repos_url' in user) {
      let res = await fetch(user.repos_url);
      return await res.json();
    } else {
      return [];
    }
  }
  function getIssues(repos = _repos) {
    repos.forEach(async repo_data => {
      let git__wrap = createElement('div', {class: 'git__wrap fold'});

      let repo = createElement('div', {class: 'repo'});
      repo.appendChild(createElement('span', {class: 'repo__lang', 'data-lang': repo_data.language, style: `--lang-color: ${_git_color[repo_data.language].color};`}));
      repo.appendChild(createElement('span', {class: 'repo__title'},repo_data.name));
      repo.appendChild(createElement('span', {class: 'repo__star'},repo_data.stargazers_count));
      let repo__fold_button = createElement('button', {class: 'repo__fold_button'});
      repo__fold_button.onclick = () => git__wrap.classList.toggle('fold');
      repo.appendChild(repo__fold_button);
      repo.appendChild(createElement('p', {class: 'repo__desc'},repo_data.description));
      git__wrap.appendChild(repo);

      let issue = createElement('ul', {class: 'issue'});
      git__wrap.appendChild(issue);
      git__wrap.appendChild(createElement('span', {class: 'issue_counter'}));

      document.querySelector('.git').appendChild(git__wrap);
      
      let res = await fetch(`https://api.github.com/repos/${USERNAME}/${repo_data.name}/issues`);
      (await res.json()).forEach(issue_data => {
        if (repo_data.name == `${USERNAME}.github.io`) getPosts(issue_data);
        let issue__item = createElement('li', {class: 'issue__item', 'data-state': issue_data.state});
        issue__item.appendChild(createElement('span', {class: 'issue__item__title'},issue_data.title));
        issue__item.appendChild(createElement('span', {class: 'issue__item__datetime'},timeSince(new Date(issue_data.created_at))));
        issue__item.appendChild(createElement('span', {class: 'issue__item__desc'},issue_data.body.render()));
        let issue__item__label = createElement('ul', {class: 'issue__item__label'});
        issue_data.labels.forEach(
          label_data => 
          issue__item__label.appendChild(
            createElement('li', {style: `--label-color: #${label_data.color};`},label_data.name)
            )
          );
        issue__item.appendChild(issue__item__label);
        issue.appendChild(issue__item);
      });
    });
  }
  function getPosts(issue_data) {
    let li = document.createElement('li');
        li.innerHTML = `<img src="img_url" alt="${issue_data.title}">
            <p>${issue_data.title} | (tag) | 설명...</p>
            <p>1 min ago. 안녕하세요</p>`;
        document.querySelector('.posts>ul').appendChild(li);
  }
  function alert(e) {
    console.log(e);
  }
  function gitAttr(attr, value) {
    document.querySelectorAll(`[git-target^="${attr},"]`).forEach(el => {
      let [attr, target] = el.getAttribute('git-target').split(',');
      if (target) {
        el.setAttribute(target, value);
      } else {
        el.innerHTML = value;
      }
      el.removeAttribute('git-target');
    });
  }
  function timeSince(date) {

    var seconds = Math.floor((new Date() - date) / 1000);

    var interval = seconds / 31536000;

    if (interval > 1) {
      return Math.floor(interval) + " years";
    }
    interval = seconds / 2592000;
    if (interval > 1) {
      return Math.floor(interval) + " months";
    }
    interval = seconds / 86400;
    if (interval > 1) {
      return Math.floor(interval) + " days";
    }
    interval = seconds / 3600;
    if (interval > 1) {
      return Math.floor(interval) + " hours";
    }
    interval = seconds / 60;
    if (interval > 1) {
      return Math.floor(interval) + " minutes";
    }
    return Math.floor(seconds) + " seconds";
  }

  
/**
 * 무작위 색상 코드를 만들어 주는 기능
 * @returns {string}
 */
function randomColor() {return Math.floor(Math.random()*16777215).toString(16)}

/**
 * 문자열 속 URL 을 a 태그로 치환해주는 기능
 * @param text
 * @returns {*}
 */
function renderLinkInText(text) {
    let urlRegex = /(https?:\/\/\S+)/g;
    /*
    return text.replace(urlRegex, function(url) {
        return '<a href="' + url + '">' + url + '</a>';
    })*/
    // or alternatively
    return text.replace(urlRegex, '<a href="$1" target="_blank" class="link">$1</a>')
}

/**
 * 문자열 속 URL 을 a 태그로 치환해주는 기능
 * @param text
 * @returns {*}
 * @referer : https://jung-max.github.io/2019/09/27/Web-Javascript-MarkDown%EA%B5%AC%ED%98%84/
 */
function renderMarkDownText(text) {
    //ul
    text = text.replace(/^\s*\n\*/gm, '<ul>\n*');
    text = text.replace(/^(\*.+)\s*\n([^\*])/gm, '$1\n</ul>\n\n$2');
    text = text.replace(/^\*(.+)/gm, '<li>$1</li>');

    //ol
    text = text.replace(/^\s*\n\d\./gm, '<ol>\n1.');
    text = text.replace(/^(\d\..+)\s*\n([^\d\.])/gm, '$1\n</ol>\n\n$2');
    text = text.replace(/^\d\.(.+)/gm, '<li>$1</li>');

    //blockquote
    text = text.replace(/^&gt;(.+)/gm, '<blockquote>$1</blockquote>');

    //h
    text = text.replace(/[\#]{6}(.+)/g, '<h6>$1</h6>');
    text = text.replace(/[\#]{5}(.+)/g, '<h5>$1</h5>');
    text = text.replace(/[\#]{4}(.+)/g, '<h4>$1</h4>');
    text = text.replace(/[\#]{3}(.+)/g, '<h3>$1</h3>');
    text = text.replace(/[\#]{2}(.+)/g, '<h2>$1</h2>');
    text = text.replace(/[\#]{1}(.+)/g, '<h1>$1</h1>');

    //alt h
    text = text.replace(/^(.+)\n\=+/gm, '<h1>$1</h1>');
    text = text.replace(/^(.+)\n\-+/gm, '<h2>$1</h2>');

    //images
    //text = text.replace(/\!\[([^\]]+)\]\(([^\)]+)\)/g, '<img src="$2" alt="$1" />');

    //links
    //text = text.replace(/[\[]{1}([^\]]+)[\]]{1}[\(]{1}([^\)\"]+)(\"(.+)\")?[\)]{1}/g, '<a href="$2" title="$4">$1</a>');

    //font styles
    text = text.replace(/[\*\_]{2}([^\*\_]+)[\*\_]{2}/g, '<b>$1</b>');
    text = text.replace(/[\*\_]{1}([^\*\_]+)[\*\_]{1}/g, '<i>$1</i>');
    text = text.replace(/[\~]{2}([^\~]+)[\~]{2}/g, '<del>$1</del>');

    //pre
    text = text.replace(/^\s*\n\`\`\`(([^\s]+))?/gm, '<pre class="$2">');
    text = text.replace(/^\`\`\`\s*\n/gm, '</pre>\n\n');

    //code
    text = text.replace(/[\`]{1}([^\`]+)[\`]{1}/g, '<code>$1</code>');

    text = text.replace(/(:(?![\n])[()#$@-\w]+:)/g, match => _emoji[match]);

    //p
    /*
    text = text.replace(/^\s*(\n)?(.+)/gm, function(m){
        return  /\<(\/)?(h\d|ul|ol|li|blockquote|pre|img)/.test(m) ? m : '<p>'+m+'</p>';
    });*/

    //strip p from pre
    //text = text.replace(/(\<pre.+\>)\s*\n\<p\>(.+)\<\/p\>/gm, '$1$2');

    return text;
}
let renderEmoji = String.prototype.renderEmoji = function () {
  return this.replace(/(:(?![\n])[()#$@-\w]+:)/g, match => match.replaceAll('_','') in _emoji?_emoji[match.replaceAll('_','')]:match);
}
let renderImages = String.prototype.renderImages = function () {
  return this.replace(/\!\[([^\]]+)\]\(([^\)]+)\)/g, '<img src="$2" alt="$1" />');
}
let renderLinks = String.prototype.renderLinks = function () {
  return this.replace(/[\[]{1}([^\]]+)[\]]{1}[\(]{1}([^\)\"]+)(\"(.+)\")?[\)]{1}/g, '<a href="$2" title="$4">$1</a>');
}
let render_text = String.prototype.render = function () {
  return this.renderEmoji().renderImages().renderLinks();
}


function createElement(tag, options = {},innerHTML=''){
  let el = document.createElement(tag);
  for(attr in options) el.setAttribute(attr, options[attr]);
  if(innerHTML) el.innerHTML = innerHTML;
  return el;
}

</script>

</html>